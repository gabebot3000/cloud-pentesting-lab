"""An AWS Python Pulumi program"""

import pulumi
import pulumi_aws as aws

ami = aws.ec2.get_ami(
    most_recent="true",
    owners=["679593333241"],
    filters=[{"name":"name","values":["kali-linux-2022.3b-*"]}])

default_vpc = aws.ec2.get_vpc(default="true")

group = aws.ec2.SecurityGroup(
    "kali-secgrp",
    description='Enable SSH access',
    ingress=[
        { 'protocol': 'tcp', 'from_port': 0, 'to_port': 22, 'cidr_blocks': ['0.0.0.0/0'] },
    ],
    egress=[
        { 'protocol': 'all', 'from_port': 0, 'to_port': 0, 'cidr_blocks': ['0.0.0.0/0'] },
    ],
)

server = aws.ec2.Instance(
    'Kali VM',
    instance_type="t2.micro",
    vpc_security_group_ids=[group.id],
    ami=ami.id,
    key_name="Kali EC2",
    tags={
        "Name": "kali",
    },
)

pulumi.export('ip', server.public_ip)
pulumi.export('hostname', server.public_dns)
